stages:
- test

include:
  - project: 'devops/gitlab-ci-templates'
    ref: master
    file: .gitlab-ci.yml

gitleaks:
  stage: test
  allow_failure: true

exe:
  tags:
    - nixos-starkify-runner
  script:
    - nix-shell --run "cabal build exe:starkify"
    - nix-shell --run "cabal run starkify --help"

testfiles:
  stage: test
  tags:
    - nixos-starkify-runner
  script:
    - nix-shell --run "cabal build --enable-tests"
    - nix-shell --run "cabal test"
    - nix-shell --run "cabal run testfiles"

additional_arith_test:
  stage: test
  tags:
    - nixos-starkify-runner
  script:
    - nix-shell --run "cabal test --test-option=--qc-max-success=1000"
  only:
    - master
